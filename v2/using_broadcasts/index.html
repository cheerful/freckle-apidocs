<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Using Broadcasts - Noko Developer</title>
  <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/v2/stylesheet.css" type="text/css">
</head>

<body>
  <div id="container">
    <div id="nav">
      <div id="logo">
        <a href="/">
          <img src="/assets/noko.svg" alt="Noko">
        </a>
      </div>
      Developer Documentation
      <ul id="version_switch">
        <li><a href="/v1/">API v1</a></li>
        <li><a href="/v2/">API v2</a></li>
      </ul>
      <h2>Topics</h2>
      <ul id="topics">
        <li><a href="/v2/">API Basics</a></li>
        <li><a href="/v2/authentication/">Authentication</a></li>
        <li><a href="/v2/oauth/">OAuth</a></li>
        <li><a href="/v2/migration_guide/">Migrating to Noko</a></li>
      </ul>

      <h2>Resources</h2>
      <ul id="resources">
        <li><a href="/v2/entries/">Entries</a></li>
        <li><a href="/v2/tags/">Tags</a></li>
        <li><a href="/v2/timers/">Timers</a></li>
        <li><a href="/v2/projects/">Projects</a></li>
        <li><a href="/v2/project_groups/">Project Groups</a></li>
        <li><a href="/v2/invoices/">Invoices</a></li>
        <li><a href="/v2/expenses/">Expenses</a></li>
        <li><a href="/v2/invoice_locales/">Invoice Locales</a></li>
      </ul>

      <h3 class="beta">Webhooks</h3>
      <ul id='notifications-webhooks'>
        <li><a href="/v2/using_webhooks/">Using Webhooks</a></li>
        <li><a href="/v2/webhooks/">Webhooks</a></li>
        <li><a href="/v2/webhook_events/">Webhook Events</a></li>
      </ul>

      <h3 class='beta'>Broadcasts</h3>
      <ul id='notifications-broadcasts'>
        <li><a href="/v2/using_broadcasts/">Using Broadcasts</a></li>
        <li><a href="/v2/broadcast_receivers/">Broadcast Receivers</a></li>
        <li><a href="/v2/broadcast_subjects/">Broadcast Subjects</a></li>
      </ul>

      <h2>Account Management</h2>
      <ul id="account-management">
        <li><a href="/v2/account/">Account</a></li>
        <li><a href="/v2/current_user/">Current User</a></li>
        <li><a href="/v2/users/">Users</a></li>
        <li><a href="/v2/teams/">Teams</a></li>
      </ul>
    </div>
    <div id="content">
      <h1>Using Broadcasts</h1>
      <p class="note warning">
        Freckle is now Noko! <a href="/migration_guide/">Learn how to migrate your apps here</a>
      </p>
      <div class="note warning">
 <h2>In Beta!</h2>
 <p>Webhooks and Broadcasts are in beta while we make sure they're rock solid. The specs are finalized though, so they're safe to add to your integration!</p>
</div>

<ul id="markdown-toc">
  <li><a href="#how-do-i-setup-a-broadcast-receiver" id="markdown-toc-how-do-i-setup-a-broadcast-receiver">How do I setup a Broadcast Receiver?</a></li>
  <li><a href="#how-are-broadcasts-different-than-webhooks" id="markdown-toc-how-are-broadcasts-different-than-webhooks">How are Broadcasts different than Webhooks?</a></li>
  <li><a href="#what-does-a-broadcast-look-like" id="markdown-toc-what-does-a-broadcast-look-like">What does a Broadcast look like?</a></li>
  <li><a href="#verifying-a-broadcast-payload" id="markdown-toc-verifying-a-broadcast-payload">Verifying a Broadcast payload</a></li>
  <li><a href="#broadcast-failures-and-retries" id="markdown-toc-broadcast-failures-and-retries">Broadcast failures and retries</a></li>
</ul>

<h1 id="what-are-broadcast-receivers">What are Broadcast Receivers?</h1>

<p>Broadcast Receivers allow your application or integration to be notified that it should call the API to get the latest version of specific parts of the API. You can use this to automatically keep <a href="/v2/timers">Timers</a> in sync.</p>

<p>Rather than polling for new data or changes, you can subscribe to a generic subject, and we’ll send any updates at a regular interval.</p>

<p>Once a Broadcast Receiver has been created, we’ll send <code>POST</code> requests for the subjects that you want to be notified on for that receiver.</p>

<h2 id="how-do-i-setup-a-broadcast-receiver">How do I setup a Broadcast Receiver?</h2>

<p>To create a Broadcast Receiver, you’ll need:</p>

<ul>
  <li>A publicly accessible URI for us to send events to</li>
  <li>An idea of what <a href="#broadcast-subjects">subjects</a> you want to be notified for</li>
  <li>A good name for the broadcast receiver (so you don’t forget what it’s for!)</li>
</ul>

<h3 id="which-type-of-setup-should-i-choose">Which type of setup should I choose?</h3>

<dl>
  <dt>
<a href="/v2/broadcast_receiver/">Broadcast Receiver Endpoint</a> (<strong>Strongly recommended</strong>)</dt>
  <dd>My application will be running in a production environment, I’m writing an integration for Noko in my project, or I want to automate setup.</dd>
  <dt><a href="#creating-a-broadcast-receiver-from-the-webapp">Creating a Broadcast Receiver from the Webapp</a></dt>
  <dd>My application is a script or for internal use only.</dd>
</dl>

<h3 id="creating-a-broadcast-receiver-from-the-api">Creating a Broadcast Receiver from the API</h3>

<p>In order to create a Broadcast Receiver from the API, <a href="/v2/authentication">you’ll need to have valid API credentials</a>. Using the API to manage your broadcast receivers allows you automatically set up your integration, without requiring a user to copy/paste any URLs, or configure anything else!</p>

<h3 id="creating-a-broadcast-receiver-from-the-webapp">Creating a Broadcast Receiver from the Webapp</h3>

<p>You can create a Broadcast Receiver from the main Noko app by going to the “Broadcasts” tab in your “Integrations &amp; Connected Apps” section.</p>

<h2 id="how-are-broadcasts-different-than-webhooks">How are Broadcasts different than Webhooks?</h2>

<p>Even though Broadcasts and Webhooks are similar, they solve different problems.</p>

<p>For certain parts of Noko’s API, such as <a href="/v2/timers">Timers</a>, a traditional webhook is not a good fit. These parts of Noko can change rapidly, which would generate a lot of spurious updates if they were sent as webhooks.</p>

<p>Instead, Noko tracks the latest messages as they happen, and sends them to you at regular intervals. You can then use the message to get the latest update from Noko’s API.</p>

<p>Rather than providing an instance of the resource after an event has occured, Broadcasts notify your application to request the latest version.</p>

<p>Broadcasts also do not track failures or retry messages that fail. This makes sure that you do not accidentally receive stale data, since these parts of the API can change rapidly.</p>

<h3 id="example-timer-syncing-in-a-project-management-tool">Example: Timer Syncing in a Project Management Tool</h3>

<p>Let’s say you’re writing a project management tool that integrates with your Noko account.</p>

<ul>
  <li>You want to show which Timers are running in Noko, so team members can see what you’re working on. To do this, you’d create a Broadcast Receiver that is subscribed to the <code>timer</code> subject. Noko will keep track of your latest timer activities, and send them to your app using the broadcast receiver. You can use these messages, along with the API, to show which timers are running or paused.</li>
  <li>You also want to be able to start a timer directly from your project management tool. You would use the <a href="https://developer.nokotime.com/v2/timers/#start-a-projects-timer">API to start a timer</a>
</li>
</ul>

<h2 id="what-does-a-broadcast-look-like">What does a Broadcast look like?</h2>

<p>A Broadcast has the following structure:</p>

<pre><code>POST http://dabestnokoapp.com/broadcasts/timer_messages
</code></pre>

<pre class="headers"><code>Content-Type: application/json
X-Noko-BroadcastSubject: timer
X-Noko-Signature: 97edbb33123042fb0df0f78eef173123d50b095b769f419a601fbdf40918b8fe
User-Agent: Noko-Broadcasts</code></pre>

<pre class="highlight"><code class="language-javascript"><span class="p">{</span>
  <span class="dl">"</span><span class="s2">broadcast_receiver</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">77885522</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Da Best Timer Sync</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">sent_at</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-09-30T15:19:28Z</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">last_event</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">timer.running</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">subject</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">timer</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://api.nokotime.com/v2/projects/37396/timer</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<h3 id="using-the-hypermedia-url-to-get-the-latest-data">Using the Hypermedia URL to get the latest data</h3>

<p>Broadcasts include a <a href="/v2/#hypermedia">Hypermedia URL</a> for the resource that the message is for, as part of the <code>subject</code> object. You can use this URL to get the latest version of this resource, using your <a href="/v2/authentication/">API credentials</a></p>

<h2 id="verifying-a-broadcast-payload">Verifying a Broadcast payload</h2>

<p>A secret key is automatically generated when a broadcast receiver is created, <strong>make sure you store this signature when you create your broadcast receiver!</strong> (but you can always re-roll the signature if you need to). We use this secret to generate a signature for each broadcast, so you can verify that the request came from Noko. This signature is stored in the <code>X-Noko-Signature</code> request header.</p>

<p>To verify the signature:</p>

<ol>
  <li>Retrieve the <code>secret</code> value that you stored</li>
  <li>Use a SHA 256 HMAC hexdigest to compute the hash, using the <code>secret</code> as the key.</li>
  <li>Compare your generated signature with the one in <code>X-Noko-Signature</code>.</li>
</ol>

<p><strong>Make sure to use a secure comparison method, like <a href="https://www.rubydoc.info/gems/rack/Rack/Utils#secure_compare-class_method"><code>Rack::Utils.secure_compare</code></a></strong></p>

<h2 id="broadcast-failures-and-retries">Broadcast failures and retries</h2>

<p><strong>Broadcasts do not track failures or retry messages that fail.</strong> This is to help ensure you do not accidentally receive stale data, since these resources can change rapidly.</p>


      <div id="footer">

        <div class="columns four">
          <div class="column">
            <h3>About Noko</h3>
            <ul>
              <li><a href="https://nokotime.com/manifesto">The Noko manifesto</a></li>
              <li><a href="https://nokotime.com/"> Noko plans and pricing</a></li>
              <li><a href="https://nokotime.com/terms/">Our user agreement</a></li>
              <li><a href="https://nokotime.com/privacy/">Privacy policy</a></li>
            </ul>
          </div>

          <div class="column">
            <h3>Us &amp; our company</h3>
            <ul>
              <li><a href="https://nokotime.com/team/">Meet our team</a></li>
              <li><a href="https://nokotime.com/blog/">Read our blog</a></li>
              <li><a href="https://nokotime.com/contact/">Write us</a></li>
            </ul>
          </div>

          <div class="column">
            <h3>Docs</h3>
            <ul>
              <li><a href="http://help.nokotime.com/">FAQs</a></li>
              <li><a href="http://developer.nokotime.com">Developer Documentation</a></li>
            </ul>
          </div>

          <div class="column">
            <h3>You &amp; your account</h3>
            <ul>
              <li><a href="http://help.nokotime.com/article/13-signing-in-to-freckle">How to sign in</a></li>
              <li><a href="http://help.nokotime.com/">Get help &amp; contact support</a></li>
            </ul>
          </div>

        </div>

        <div class="copyright">
          &copy; 2008-2021 Slash7 LLC, all rights reserved.<br>
          Noko® is a registered trademark of Slash7 LLC.
        </div>
      </div>
    </div>
  </div>

  <script async src="https://secure.nokotime.com/help/help.js"></script>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

  <script>
    $(function(){
      function setTabs(to){
        // change all tabs on page to value
        var tabs = $('.tabs')
        tabs.find('.selector DIV').removeClass('active')
        tabs.find('.selector DIV.'+to).addClass('active')
        tabs.find('.tab').removeClass('active')
        tabs.find('.tab.'+to).addClass('active')

        // change tabs that don't have an active tab to show first tab
        tabs.find('.selector').each(function(){
          if ($(this).find('DIV.active').length > 0) return

          console.log(this)
          $(this).find('DIV').first().addClass('active')
          $(this).closest('.tabs').find('.tab').first().addClass('active')
        })

        // save for later
        localStorage && (localStorage.dataFormat = to)
      }

      $('.tabs .selector div').on('click', function(){
        setTabs($(this).attr('class'))
      })

      setTabs(localStorage ? (localStorage.dataFormat || 'json') : 'json')
    })
  </script>

  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37896092-1']);
    _gaq.push(['_setDomainName', 'nokotime.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body>
</html>
